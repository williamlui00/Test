def userInput(){
    def userInput
    while (true) {
        userInput = input(
            id: 'userInput', 
            message:  'Please provide the following message', 
            parameters: [
                string(
                    name: 'USERNAME',
                    defaultValue: '',
                    description: 'Enter your name'
                    ),
                choice(
                    name: 'ACTION',
                    choices: [
                        'Add',
                        'Delete',
                        'Modify'
                        ],
                    description: 'Select an action'
                    )
                ] 
            )
            if (userInput['USERNAME'].trim()){
                break
            } else {
                echo "Username cannot be empty. Please try again"
            }
    }
    return userInput
}

node {
    stage('User Input') {
        script {
            def inputValues = userInput()
            def userName = inputValues['USERNAME']
            def action = inputValues['ACTION']
            
            echo "User Name: ${userName}"
            echo "Selected Action: ${action}"
            
            if (action == 'Add') {
                echo "Adding ${userName}"
            } else if (action == 'Delete'){
                echo "Deleting ${userName}"
            } else if (action == 'Modify') {
                echo "Modifying ${userName}"
            }
                
        }   
    }
}
